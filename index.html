<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Listor â€¢ Multi-inkÃ¶p</title>
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#1f2937">
  <style>
    :root { --bg:#0b0f14; --card:#111827; --ink:#e5e7eb; --muted:#9ca3af; --accent:#38bdf8; }
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial}
    header{position:sticky;top:0;background:linear-gradient(0deg,transparent,rgba(0,0,0,.32)),var(--bg);padding:12px 16px;border-bottom:1px solid #1f2937}
    h1{margin:0;font-size:18px;letter-spacing:.3px}
    main{padding:16px;max-width:900px;margin:0 auto}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    .card{background:var(--card);border:1px solid #1f2937;border-radius:14px;padding:12px}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
    input,select,button,textarea{background:#0f172a;color:var(--ink);border:1px solid #223047;border-radius:12px;padding:10px;font:inherit}
    button{cursor:pointer}
    .list-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(230px,1fr));gap:12px}
    .list-card{padding:12px}
    .list-card h3{margin:0 0 8px 0;font-size:16px}
    .item{display:grid;grid-template-columns:auto 1fr auto;gap:8px;align-items:center;padding:8px;border:1px solid #243043;border-radius:12px;margin:6px 0;background:#0b1320}
    .item a{color:var(--accent);text-decoration:none}
    .badge{font-size:11px;color:var(--muted);border:1px solid #2b3a4f;border-radius:999px;padding:2px 8px}
    .muted{color:var(--muted)}
    .row-break{flex-basis:100%;height:0}
    .pill{background:#0e1a2a;border:1px solid #233449;border-radius:999px;padding:8px 10px}
    .danger{border-color:#5b1f28;color:#fda4af;background:#2a0c12}
    .ghost{background:transparent}
    .w-100{width:100%}
  </style>
</head>
<body>
  <header>
    <h1>ðŸ›’ Multi-inkÃ¶pslistor</h1>
  </header>

  <main>
    <section class="card">
      <div class="toolbar">
        <input id="newListName" placeholder="Ny lista: t.ex. 'Mat v.45' eller 'Ã–nskelista Tech'" />
        <select id="newListType">
          <option value="shopping">Vardagshandel</option>
          <option value="wishlist">Ã–nskelista</option>
          <option value="projekt">Projekt</option>
          <option value="katter">Katter</option>
        </select>
        <button id="addListBtn">Skapa lista</button>
        <span class="pill muted">Allt sparas lokalt pÃ¥ enheten</span>
        <button id="exportBtn" class="ghost">Exportera JSON</button>
        <input id="importFile" type="file" accept="application/json" style="display:none">
        <button id="importBtn" class="ghost">Importera JSON</button>
      </div>

      <div class="row">
        <select id="activeListSelect"></select>
        <button id="deleteListBtn" class="danger">Ta bort lista</button>
      </div>

      <div class="row" style="margin-top:10px">
        <input id="itemTitle" class="w-100" placeholder="LÃ¤gg till sakâ€¦ (t.ex. 'HavremjÃ¶lk' eller 'SSD 2TB')" />
        <div class="row">
          <input id="itemQty" type="number" step="1" min="0" placeholder="Antal" style="width:110px">
          <input id="itemPrice" type="number" step="0.01" min="0" placeholder="Pris" style="width:120px">
          <input id="itemLink" placeholder="LÃ¤nk (valfritt)">
          <input id="itemImg" placeholder="Bild-URL (valfritt)">
          <select id="itemCat">
            <option value="">Kategoriâ€¦</option>
            <option>Mat</option><option>Hem</option><option>Tech</option><option>Katter</option><option>Projekt</option>
          </select>
          <button id="addItemBtn">LÃ¤gg till</button>
        </div>
      </div>
    </section>

    <section class="card" style="margin-top:12px">
      <div class="row">
        <span class="badge">Visar aktiv lista</span>
        <span id="activeListMeta" class="muted"></span>
      </div>
      <div id="items" class="list-grid"></div>
    </section>
  </main>

  <script>
    // ---- Lagring (localStorage) ----
    const KEY = 'multiLists.v1';
    const load = () => JSON.parse(localStorage.getItem(KEY) || '{"lists":[]}');
    const save = (data) => localStorage.setItem(KEY, JSON.stringify(data));
    const uid = () => Math.random().toString(36).slice(2,9);

    let state = load();
    if (!state.lists.length) {
      // Skapa en startlista fÃ¶rsta gÃ¥ngen
      state.lists.push({ id: uid(), name: 'Min fÃ¶rsta lista', type: 'shopping', created: Date.now(), items: [] });
      save(state);
    }
    let activeListId = state.lists[0].id;

    // ---- DOM helpers ----
    const $ = (id) => document.getElementById(id);

    function refreshListSelect() {
      const sel = $('activeListSelect');
      sel.innerHTML = '';
      state.lists.forEach(l=>{
        const opt = document.createElement('option');
        opt.value = l.id;
        opt.textContent = `${l.name} (${l.type})`;
        sel.appendChild(opt);
      });
      sel.value = activeListId;
      renderItems();
    }

    function currentList() {
      return state.lists.find(l => l.id === activeListId);
    }

    function renderItems() {
      const list = currentList();
      $('activeListMeta').textContent = `Skapad ${new Date(list.created).toLocaleDateString()} â€¢ ${list.items.filter(i=>i.done).length}/${list.items.length} klara`;
      const wrap = $('items');
      wrap.innerHTML = '';

      // Sortera: ej klara fÃ¶rst
      const items = [...list.items].sort((a,b)=> (a.done===b.done)? 0 : a.done? 1 : -1);

      items.forEach(it=>{
        const card = document.createElement('div');
        card.className='list-card item';

        const checkbox = document.createElement('input');
        checkbox.type='checkbox';
        checkbox.checked = !!it.done;
        checkbox.addEventListener('change',()=>{
          it.done = checkbox.checked;
          save(state); renderItems();
        });

        const content = document.createElement('div');
        const title = document.createElement('div');
        title.innerHTML = `<strong>${escapeHtml(it.title)}</strong> ${it.qty? 'â€¢ x'+it.qty:''} ${it.price? 'â€¢ '+Number(it.price).toFixed(2)+' kr':''}`;
        const meta = document.createElement('div');
        meta.className='muted';
        meta.textContent = it.category ? it.category : '';
        const links = document.createElement('div');
        if (it.link) {
          const a = document.createElement('a'); a.href = it.link; a.target='_blank'; a.rel='noopener';
          a.textContent = 'LÃ¤nk';
          links.appendChild(a);
        }
        content.appendChild(title);
        if (it.img) {
          const img = document.createElement('img');
          img.src = it.img; img.alt='bild'; img.style.maxWidth='100%'; img.style.borderRadius='10px'; img.style.margin='6px 0';
          content.appendChild(img);
        }
        content.appendChild(meta);
        content.appendChild(links);

        const del = document.createElement('button');
        del.className='ghost';
        del.textContent='ðŸ—‘ï¸';
        del.title='Ta bort';
        del.addEventListener('click',()=>{
          const list = currentList();
          list.items = list.items.filter(x=>x.id!==it.id);
          save(state); renderItems();
        });

        card.appendChild(checkbox);
        card.appendChild(content);
        card.appendChild(del);
        wrap.appendChild(card);
      });
    }

    function escapeHtml(str){ return str?.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m])) || '' }

    // ---- UI handlers ----
    $('addListBtn').onclick = ()=>{
      const name = $('newListName').value.trim();
      const type = $('newListType').value;
      if (!name) return;
      const l = { id: uid(), name, type, created: Date.now(), items: [] };
      state.lists.push(l); activeListId = l.id; save(state);
      $('newListName').value='';
      refreshListSelect();
    };

    $('activeListSelect').onchange = (e)=>{ activeListId = e.target.value; renderItems(); };

    $('deleteListBtn').onclick = ()=>{
      if (!confirm('Ta bort hela listan?')) return;
      state.lists = state.lists.filter(l=>l.id!==activeListId);
      if (!state.lists.length) state.lists.push({ id: uid(), name:'Ny lista', type:'shopping', created:Date.now(), items:[] });
      activeListId = state.lists[0].id; save(state); refreshListSelect();
    };

    $('addItemBtn').onclick = ()=>{
      const t=$('itemTitle').value.trim();
      if(!t) return;
      const list = currentList();
      list.items.push({
        id: uid(),
        title: t,
        qty: $('itemQty').value ? Number($('itemQty').value) : null,
        price: $('itemPrice').value ? Number($('itemPrice').value) : null,
        link: $('itemLink').value.trim() || null,
        img: $('itemImg').value.trim() || null,
        category: $('itemCat').value || null,
        done:false,
        added: Date.now()
      });
      ['itemTitle','itemQty','itemPrice','itemLink','itemImg'].forEach(id=>$(id).value=''); $('itemCat').value='';
      save(state); renderItems();
    };

    $('exportBtn').onclick = ()=>{
      const blob = new Blob([JSON.stringify(state,null,2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href=url; a.download='multi-inkopslista.json'; a.click();
      URL.revokeObjectURL(url);
    };

    $('importBtn').onclick = ()=> $('importFile').click();
    $('importFile').onchange = async (e)=>{
      const file = e.target.files[0]; if(!file) return;
      const text = await file.text();
      try {
        const data = JSON.parse(text);
        if (!data.lists) throw new Error('Ogiltigt format');
        state = data;
        if (!state.lists.length) throw new Error('Tomt');
        activeListId = state.lists[0].id;
        save(state); refreshListSelect();
      } catch(err){ alert('Kunde inte importera: '+err.message); }
    };

    // ---- PWA: registrera service worker ----
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js');
      });
    }

    // Init
    refreshListSelect();
  </script>
</body>
</html>